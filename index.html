<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>지리 히트맵 대시보드 (로컬 전용)</title>
  <meta name="description" content="CSV를 브라우저에서만 읽어 글로벌 히트맵, 상승/하락 국가, 대륙별 뉴스까지 한 페이지에서 확인합니다." />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; style-src 'self' 'unsafe-inline' https:; script-src 'self' https: 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https:; font-src 'self' https:; frame-ancestors 'none'; base-uri 'self'; form-action 'self'">
  <link rel="icon" href="data:,"/>
  <link rel="stylesheet" href="assets/style.css" />
  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="logo">🗺️</div>
      <div>
        <h1>지리 히트맵 대시보드</h1>
        <p class="sub">히트맵 · 상승/하락 국가 · 대륙별 뉴스</p>
      </div>
    </div>
    <div class="header-actions">
      <button id="themeToggle" class="btn ghost" title="테마 전환">🌓</button>
      <a href="README.html" target="_blank" class="btn outline">도움말</a>
    </div>
  </header>

  <div class="toolbar">
    <input type="file" id="fileMetrics" accept=".csv,text/csv" style="padding:8px 12px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:6px"/>
    <button id="loadSample" class="btn">📁 샘플 불러오기</button>
    <button id="reset" class="btn ghost">초기화</button>
    <div class="status-badge" id="meta">데이터를 불러오세요</div>
  </div>

  <div class="filter-controls">
    <label><strong>Show Top:</strong> <input type="number" id="topN" value="180" min="10" max="250" style="padding:6px 10px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:6px;margin-left:8px;width:80px"/></label>
    <label><strong>Sort By:</strong>
      <select id="sortBy" style="padding:6px 10px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:6px;margin-left:8px">
        <option value="revenue" selected>Total Traffic</option>
        <option value="change_desc">+ 변화량 큰 순</option>
        <option value="change_asc">- 변화량 큰 순</option>
      </select>
    </label>
    <label><input type="checkbox" id="groupByContinent" checked/> <strong>Group by Sector (Continent)</strong></label>
    <label style="margin-top:8px"><strong>Comparison:</strong>
      <select id="comparisonType" style="padding:6px 10px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:6px;margin-left:8px;font-size:13px">
        <option value="DoD" selected>DoD (Day over Day)</option>
        <option value="WoW">WoW (Week over Week)</option>
        <option value="MoM">MoM (Month over Month)</option>
        <option value="YoY">YoY (Year over Year)</option>
      </select>
    </label>
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px;padding-top:12px;border-top:1px solid var(--border)">
      <label><strong>Date Range:</strong> 
        <input type="date" id="startDate" style="padding:6px 10px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:6px;margin-left:8px"/>
      </label>
      <label><strong>~</strong> 
        <input type="date" id="endDate" style="padding:6px 10px;border:1px solid var(--border);background:var(--panel);color:var(--text);border-radius:6px;margin-left:8px"/>
      </label>
      <button id="btnApplyDateRange" style="padding:6px 12px;background:linear-gradient(135deg,#238636,#2ea043);border:none;border-radius:6px;color:#fff;font-weight:600;cursor:pointer;font-size:12px">Apply</button>
      <button id="btnClearDateRange" style="padding:6px 12px;background:var(--panel);border:1px solid var(--border);border-radius:6px;color:var(--text);font-weight:600;cursor:pointer;font-size:12px">Clear</button>
    </div>
  </div>

  <main class="layout" style="grid-template-columns: 1fr;">
    <section class="panel right">
      <section id="tab-heatmap" class="tab-panel active card" style="display:block">
        <div id="heatmap" class="chart-box"></div>
      </section>

      <section id="tab-movers" class="tab-panel card">
        <h2>상승/하락 국가</h2>
        <div class="grid two">
          <div>
            <h3>📈 상승</h3>
            <ol id="listUp" class="list-compact"></ol>
          </div>
          <div>
            <h3>📉 하락</h3>
            <ol id="listDown" class="list-compact"></ol>
          </div>
        </div>
      </section>

      <section id="tab-country" class="tab-panel card">
        <h2 id="countryTitle">국가 상세</h2>
        <canvas id="countryChart" height="140"></canvas>
        <div id="countryFacts" class="facts-grid" style="margin-top:.6rem;"></div>
        <div class="table-wrap">
          <table id="countryTable" class="data-table">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section id="tab-news" class="tab-panel card">
        <h2>🌍 대륙별 주요 뉴스</h2>
        <div id="newsWrap" class="news-wrap"></div>
        <div class="small muted">뉴스는 API를 통해 불러옵니다. API 엔드포인트를 설정하고 "뉴스 불러오기" 버튼을 클릭하세요.</div>
      </section>
    </section>
  </main>

  <footer class="app-footer small muted">
    <div>⚠️ 지표 CSV는 브라우저에서만 처리됩니다. 뉴스와 상세정보는 API를 통해 가져옵니다.</div>
    <div>© Geo Dashboard · MIT License</div>
  </footer>

  <script type="module" src="assets/app.js"></script>
</body>
</html>
